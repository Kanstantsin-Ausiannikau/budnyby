/*!
* Fine Uploader
*
* Copyright 2013, Widen Enterprises, Inc. info@fineuploader.com
*
* Version: 4.0.3 (custom build)
*
* Homepage: http://fineuploader.com
*
* Repository: git://github.com/Widen/fine-uploader.git
*
* Licensed under GNU GPL v3, see LICENSE
*/
var qq=function(e){"use strict";return{hide:function(){e.style.display="none";return this},attach:function(t,n){if(e.addEventListener){e.addEventListener(t,n,false)}else if(e.attachEvent){e.attachEvent("on"+t,n)}return function(){qq(e).detach(t,n)}},detach:function(t,n){if(e.removeEventListener){e.removeEventListener(t,n,false)}else if(e.attachEvent){e.detachEvent("on"+t,n)}return this},contains:function(t){if(!t){return false}if(e===t){return true}if(e.contains){return e.contains(t)}else{return!!(t.compareDocumentPosition(e)&8)}},insertBefore:function(t){t.parentNode.insertBefore(e,t);return this},remove:function(){e.parentNode.removeChild(e);return this},css:function(t){if(t.opacity!=null){if(typeof e.style.opacity!=="string"&&typeof e.filters!=="undefined"){t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"}}qq.extend(e.style,t);return this},hasClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");return n.test(e.className)},addClass:function(t){if(!qq(e).hasClass(t)){e.className+=" "+t}return this},removeClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,"");return this},getByClass:function(t){var n,r=[];if(e.querySelectorAll){return e.querySelectorAll("."+t)}n=e.getElementsByTagName("*");qq.each(n,function(e,n){if(qq(n).hasClass(t)){r.push(n)}});return r},children:function(){var t=[],n=e.firstChild;while(n){if(n.nodeType===1){t.push(n)}n=n.nextSibling}return t},setText:function(t){e.innerText=t;e.textContent=t;return this},clearText:function(){return qq(e).setText("")},hasAttribute:function(t){var n;if(e.hasAttribute){if(!e.hasAttribute(t)){return false}return/^false$/i.exec(e.getAttribute(t))==null}else{n=e[t];if(n===undefined){return false}return/^false$/i.exec(n)==null}}}};qq.log=function(e,t){"use strict";if(window.console){if(!t||t==="info"){window.console.log(e)}else{if(window.console[t]){window.console[t](e)}else{window.console.log("<"+t+"> "+e)}}}};qq.isObject=function(e){"use strict";return e&&!e.nodeType&&Object.prototype.toString.call(e)==="[object Object]"};qq.isFunction=function(e){"use strict";return typeof e==="function"};qq.isArray=function(e){"use strict";return Object.prototype.toString.call(e)==="[object Array]"||window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer};qq.isItemList=function(e){"use strict";return Object.prototype.toString.call(e)==="[object DataTransferItemList]"};qq.isNodeList=function(e){"use strict";return Object.prototype.toString.call(e)==="[object NodeList]"||e.item&&e.namedItem};qq.isString=function(e){"use strict";return Object.prototype.toString.call(e)==="[object String]"};qq.trimStr=function(e){if(String.prototype.trim){return e.trim()}return e.replace(/^\s+|\s+$/g,"")};qq.format=function(e){"use strict";var t=Array.prototype.slice.call(arguments,1),n=e;qq.each(t,function(e,t){n=n.replace(/{}/,t)});return n};qq.isFile=function(e){"use strict";return window.File&&Object.prototype.toString.call(e)==="[object File]"};qq.isFileList=function(e){return window.FileList&&Object.prototype.toString.call(e)==="[object FileList]"};qq.isFileOrInput=function(e){"use strict";return qq.isFile(e)||qq.isInput(e)};qq.isInput=function(e){if(window.HTMLInputElement){if(Object.prototype.toString.call(e)==="[object HTMLInputElement]"){if(e.type&&e.type.toLowerCase()==="file"){return true}}}if(e.tagName){if(e.tagName.toLowerCase()==="input"){if(e.type&&e.type.toLowerCase()==="file"){return true}}}return false};qq.isBlob=function(e){"use strict";return window.Blob&&Object.prototype.toString.call(e)==="[object Blob]"};qq.isXhrUploadSupported=function(){"use strict";var e=document.createElement("input");e.type="file";return e.multiple!==undefined&&typeof File!=="undefined"&&typeof FormData!=="undefined"&&typeof qq.createXhrInstance().upload!=="undefined"};qq.createXhrInstance=function(){if(window.XMLHttpRequest){return new XMLHttpRequest}try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){qq.log("Neither XHR or ActiveX are supported!","error");return null}};qq.isFolderDropSupported=function(e){"use strict";return e.items&&e.items[0].webkitGetAsEntry};qq.isFileChunkingSupported=function(){"use strict";return!qq.android()&&qq.isXhrUploadSupported()&&(File.prototype.slice!==undefined||File.prototype.webkitSlice!==undefined||File.prototype.mozSlice!==undefined)};qq.sliceBlob=function(e,t,n){var r=e.slice||e.mozSlice||e.webkitSlice;return r.call(e,t,n)};qq.arrayBufferToHex=function(e){var t="",n=new Uint8Array(e);qq.each(n,function(e,n){var r=n.toString(16);if(r.length<2){r="0"+r}t+=r});return t};qq.readBlobToHex=function(e,t,n){var r=qq.sliceBlob(e,t,t+n),i=new FileReader,s=new qq.Promise;i.onload=function(){s.success(qq.arrayBufferToHex(i.result))};i.readAsArrayBuffer(r);return s};qq.extend=function(e,t,n){"use strict";qq.each(t,function(t,r){if(n&&qq.isObject(r)){if(e[t]===undefined){e[t]={}}qq.extend(e[t],r,true)}else{e[t]=r}});return e};qq.override=function(e,t){var n={},r=t(n);qq.each(r,function(t,r){if(e[t]!==undefined){n[t]=e[t]}e[t]=r});return e};qq.indexOf=function(e,t,n){"use strict";if(e.indexOf){return e.indexOf(t,n)}n=n||0;var r=e.length;if(n<0){n+=r}for(;n<r;n+=1){if(e.hasOwnProperty(n)&&e[n]===t){return n}}return-1};qq.getUniqueId=function(){"use strict";return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})};qq.ie=function(){"use strict";return navigator.userAgent.indexOf("MSIE")!==-1};qq.ie7=function(){"use strict";return navigator.userAgent.indexOf("MSIE 7")!==-1};qq.ie10=function(){"use strict";return navigator.userAgent.indexOf("MSIE 10")!==-1};qq.safari=function(){"use strict";return navigator.vendor!==undefined&&navigator.vendor.indexOf("Apple")!==-1};qq.chrome=function(){"use strict";return navigator.vendor!==undefined&&navigator.vendor.indexOf("Google")!==-1};qq.firefox=function(){"use strict";return navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==undefined&&navigator.vendor===""};qq.windows=function(){"use strict";return navigator.platform==="Win32"};qq.android=function(){"use strict";return navigator.userAgent.toLowerCase().indexOf("android")!==-1};qq.ios7=function(){"use strict";return qq.ios()&&navigator.userAgent.indexOf(" OS 7_")!==-1};qq.ios=function(){"use strict";return navigator.userAgent.indexOf("iPad")!==-1||navigator.userAgent.indexOf("iPod")!==-1||navigator.userAgent.indexOf("iPhone")!==-1};qq.preventDefault=function(e){"use strict";if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}};qq.toElement=function(){"use strict";var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;e.removeChild(n);return n}}();qq.each=function(e,t){"use strict";var n,r;if(e){if(window.Storage&&e.constructor===window.Storage){for(n=0;n<e.length;n++){r=t(e.key(n),e.getItem(e.key(n)));if(r===false){break}}}else if(qq.isArray(e)||qq.isItemList(e)||qq.isNodeList(e)){for(n=0;n<e.length;n++){r=t(n,e[n]);if(r===false){break}}}else if(qq.isString(e)){for(n=0;n<e.length;n++){r=t(n,e.charAt(n));if(r===false){break}}}else{for(n in e){if(Object.prototype.hasOwnProperty.call(e,n)){r=t(n,e[n]);if(r===false){break}}}}}};qq.bind=function(e,t){if(qq.isFunction(e)){var n=Array.prototype.slice.call(arguments,2);return function(){var r=qq.extend([],n);if(arguments.length){r=r.concat(Array.prototype.slice.call(arguments))}return e.apply(t,r)}}throw new Error("first parameter must be a function!")};qq.obj2url=function(e,t,n){"use strict";var r=[],i="&",s=function(e,n){var i=t?/\[\]$/.test(t)?t:t+"["+n+"]":n;if(i!=="undefined"&&n!=="undefined"){r.push(typeof e==="object"?qq.obj2url(e,i,true):Object.prototype.toString.call(e)==="[object Function]"?encodeURIComponent(i)+"="+encodeURIComponent(e()):encodeURIComponent(i)+"="+encodeURIComponent(e))}};if(!n&&t){i=/\?/.test(t)?/\?$/.test(t)?"":"&":"?";r.push(t);r.push(qq.obj2url(e))}else if(Object.prototype.toString.call(e)==="[object Array]"&&typeof e!=="undefined"){qq.each(e,function(e,t){s(t,e)})}else if(typeof e!=="undefined"&&e!==null&&typeof e==="object"){qq.each(e,function(e,t){s(t,e)})}else{r.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}if(t){return r.join(i)}else{return r.join(i).replace(/^&/,"").replace(/%20/g,"+")}};qq.obj2FormData=function(e,t,n){"use strict";if(!t){t=new FormData}qq.each(e,function(e,r){e=n?n+"["+e+"]":e;if(qq.isObject(r)){qq.obj2FormData(r,t,e)}else if(qq.isFunction(r)){t.append(e,r())}else{t.append(e,r)}});return t};qq.obj2Inputs=function(e,t){"use strict";var n;if(!t){t=document.createElement("form")}qq.obj2FormData(e,{append:function(e,r){n=document.createElement("input");n.setAttribute("name",e);n.setAttribute("value",r);t.appendChild(n)}});return t};qq.setCookie=function(e,t,n){var r=new Date,i="";if(n){r.setTime(r.getTime()+n*24*60*60*1e3);i="; expires="+r.toGMTString()}document.cookie=e+"="+t+i+"; path=/"};qq.getCookie=function(e){var t=e+"=",n=document.cookie.split(";"),r;qq.each(n,function(e,n){var i=n;while(i.charAt(0)==" "){i=i.substring(1,i.length)}if(i.indexOf(t)===0){r=i.substring(t.length,i.length);return false}});return r};qq.getCookieNames=function(e){var t=document.cookie.split(";"),n=[];qq.each(t,function(t,r){r=qq.trimStr(r);var i=r.indexOf("=");if(r.match(e)){n.push(r.substr(0,i))}});return n};qq.deleteCookie=function(e){qq.setCookie(e,"",-1)};qq.areCookiesEnabled=function(){var e=Math.random()*1e5,t="qqCookieTest:"+e;qq.setCookie(t,1);if(qq.getCookie(t)){qq.deleteCookie(t);return true}return false};qq.parseJson=function(json){if(window.JSON&&qq.isFunction(JSON.parse)){return JSON.parse(json)}else{return eval("("+json+")")}};qq.getExtension=function(e){var t=e.lastIndexOf(".")+1;if(t>0){return e.substr(t,e.length-t)}};qq.DisposeSupport=function(){"use strict";var e=[];return{dispose:function(){var t;do{t=e.shift();if(t){t()}}while(t)},attach:function(){var e=arguments;this.addDisposer(qq(e[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}};qq.version="4.0.3";qq.supportedFeatures=function(){function h(){var e=true,t;try{t=document.createElement("input");t.type="file";qq(t).hide();if(t.disabled){e=false}}catch(n){e=false}return e}function p(){return qq.chrome()&&navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/)!==undefined}function d(){return qq.chrome()&&navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)!==undefined}function v(){if(window.XMLHttpRequest){var e=qq.createXhrInstance();return e.withCredentials!==undefined}return false}function m(){return window.XDomainRequest!==undefined}function g(){if(v()){return true}return m()}function y(){return document.createElement("input").webkitdirectory!==undefined}var e,t,n,r,i,s,o,u,a,f,l,c;e=h();t=e&&qq.isXhrUploadSupported();n=t&&p();r=t&&qq.isFileChunkingSupported();i=t&&r&&qq.areCookiesEnabled();s=t&&d();o=e&&(window.postMessage!==undefined||t);a=v();u=m();f=g();l=y();c=t&&window.FileReader!==undefined;return{uploading:e,ajaxUploading:t,fileDrop:t,folderDrop:n,chunking:r,resume:i,uploadCustomHeaders:t,uploadNonMultipart:t,itemSizeValidation:t,uploadViaPaste:s,progressBar:t,uploadCors:o,deleteFileCorsXhr:a,deleteFileCorsXdr:u,deleteFileCors:f,canDetermineSize:t,folderSelection:l,imagePreviews:c}}();qq.Promise=function(){"use strict";var e,t,n=[],r=[],i=[],s=0;return{then:function(i,o){if(s===0){if(i){n.push(i)}if(o){r.push(o)}}else if(s===-1&&o){o.apply(null,t)}else if(i){i.apply(null,e)}return this},done:function(n){if(s===0){i.push(n)}else{n.apply(null,t===undefined?e:t)}return this},success:function(){s=1;e=arguments;if(n.length){qq.each(n,function(t,n){n.apply(null,e)})}if(i.length){qq.each(i,function(t,n){n.apply(null,e)})}return this},failure:function(){s=-1;t=arguments;if(r.length){qq.each(r,function(e,n){n.apply(null,t)})}if(i.length){qq.each(i,function(e,n){n.apply(null,t)})}return this}}};qq.isPromise=function(e){return e&&e.then&&e.done};qq.UploadButton=function(e){"use strict";function s(){var e=document.createElement("input");e.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME,i);if(n.multiple){e.setAttribute("multiple","")}if(n.folders&&qq.supportedFeatures.folderSelection){e.setAttribute("webkitdirectory","")}if(n.acceptFiles){e.setAttribute("accept",n.acceptFiles)}e.setAttribute("type","file");e.setAttribute("name",n.name);qq(e).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0});n.element.appendChild(e);t.attach(e,"change",function(){n.onChange(e)});t.attach(e,"mouseover",function(){qq(n.element).addClass(n.hoverClass)});t.attach(e,"mouseout",function(){qq(n.element).removeClass(n.hoverClass)});t.attach(e,"focus",function(){qq(n.element).addClass(n.focusClass)});t.attach(e,"blur",function(){qq(n.element).removeClass(n.focusClass)});if(window.attachEvent){e.setAttribute("tabIndex","-1")}return e}var t=new qq.DisposeSupport,n={element:null,multiple:false,acceptFiles:null,folders:false,name:"qqfile",onChange:function(e){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"},r,i;qq.extend(n,e);i=qq.getUniqueId();qq(n.element).css({position:"relative",overflow:"hidden",direction:"ltr"});r=s();return{getInput:function(){return r},getButtonId:function(){return i},setMultiple:function(e){if(e!==n.multiple){if(e){r.setAttribute("multiple","")}else{r.removeAttribute("multiple")}}},setAcceptFiles:function(e){if(e!==n.acceptFiles){r.setAttribute("accept",e)}},reset:function(){if(r.parentNode){qq(r).remove()}qq(n.element).removeClass(n.focusClass);r=s()}}};qq.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id";qq.UploadData=function(e){function o(e){if(qq.isArray(e)){var r=[];qq.each(e,function(e,i){r.push(t[n[i]])});return r}return t[n[e]]}function u(e){if(qq.isArray(e)){var n=[];qq.each(e,function(e,i){n.push(t[r[i]])});return n}return t[r[e]]}function a(e){var n=[],r=[].concat(e);qq.each(r,function(e,r){var s=i[r];if(s!==undefined){qq.each(s,function(e,r){n.push(t[r])})}});return n}var t=[],n={},r={},i={},s;s={added:function(s){var o=e.getUuid(s),u=e.getName(s),a=e.getSize(s),f=qq.status.SUBMITTING;var l=t.push({id:s,name:u,originalName:u,uuid:o,size:a,status:f})-1;n[s]=l;r[o]=l;if(i[f]===undefined){i[f]=[]}i[f].push(l);e.onStatusChange(s,undefined,f)},retrieve:function(e){if(qq.isObject(e)&&t.length){if(e.id!==undefined){return o(e.id)}else if(e.uuid!==undefined){return u(e.uuid)}else if(e.status){return a(e.status)}}else{return qq.extend([],t,true)}},reset:function(){t=[];n={};r={};i={}},setStatus:function(r,s){var o=n[r],u=t[o].status,a=qq.indexOf(i[u],o);i[u].splice(a,1);t[o].status=s;if(i[s]===undefined){i[s]=[]}i[s].push(o);e.onStatusChange(r,u,s)},uuidChanged:function(e,i){var s=n[e],o=t[s].uuid;t[s].uuid=i;r[i]=s;delete r[o]},nameChanged:function(e,r){var i=n[e];t[i].name=r}};return s};qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"};qq.basePublicApi={log:function(e,t){if(this._options.debug&&(!t||t==="info")){qq.log("[FineUploader "+qq.version+"] "+e)}else if(t&&t!=="info"){qq.log("[FineUploader "+qq.version+"] "+e,t)}},setParams:function(e,t){if(t==null){this._options.request.params=e}else{this._paramsStore.setParams(e,t)}},setDeleteFileParams:function(e,t){if(t==null){this._options.deleteFile.params=e}else{this._deleteFileParamsStore.setParams(e,t)}},setEndpoint:function(e,t){if(t==null){this._options.request.endpoint=e}else{this._endpointStore.setEndpoint(e,t)}},getInProgress:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED]}).length},getNetUploads:function(){return this._netUploaded},uploadStoredFiles:function(){var e;if(this._storedIds.length===0){this._itemError("noFilesError")}else{while(this._storedIds.length){e=this._storedIds.shift();this._handler.upload(e)}}},clearStoredFiles:function(){this._storedIds=[]},retry:function(e){return this._manualRetry(e)},cancel:function(e){this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;qq.extend(e,this._storedIds);qq.each(e,function(e,n){t.cancel(n)});this._handler.cancelAll()},reset:function(){this.log("Resetting uploader...");this._handler.reset();this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._thumbnailUrls=[];qq.each(this._buttons,function(e,t){t.reset()});this._paramsStore.reset();this._endpointStore.reset();this._netUploadedOrQueued=0;this._netUploaded=0;this._uploadData.reset();this._buttonIdsForFileIds=[];if(this._pasteHandler){this._pasteHandler.reset()}},addFiles:function(e,t,n){var r=this,i=[],s,o,u;if(e){if(!qq.isFileList(e)){e=[].concat(e)}for(s=0;s<e.length;s+=1){o=e[s];if(qq.isFileOrInput(o)){if(qq.isInput(o)&&qq.supportedFeatures.ajaxUploading){for(u=0;u<o.files.length;u++){i.push(o.files[u])}}else{i.push(o)}}else{r.log(o+" is not a File or INPUT element!  Ignoring!","warn")}}this.log("Received "+i.length+" files or inputs.");this._prepareItemsForUpload(i,t,n)}},addBlobs:function(e,t,n){if(e){var r=[].concat(e),i=[],s=this;qq.each(r,function(e,t){if(qq.isBlob(t)&&!qq.isFileOrInput(t)){i.push({blob:t,name:s._options.blobs.defaultName})}else if(qq.isObject(t)&&t.blob&&t.name){i.push(t)}else{s.log("addBlobs: entry at index "+e+" is not a Blob or a BlobData object","error")}});this._prepareItemsForUpload(i,t,n)}else{this.log("undefined or non-array parameter passed into addBlobs","error")}},getUuid:function(e){return this._handler.getUuid(e)},setUuid:function(e,t){return this._handler.setUuid(e,t)},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._handler.getSize(e)},getName:function(e){return this._handler.getName(e)},setName:function(e,t){this._handler.setName(e,t);this._uploadData.nameChanged(e,t)},getFile:function(e){return this._handler.getFile(e)},deleteFile:function(e){this._onSubmitDelete(e)},setDeleteFileEndpoint:function(e,t){if(t==null){this._options.deleteFile.endpoint=e}else{this._deleteFileEndpointStore.setEndpoint(e,t)}},doesExist:function(e){return this._handler.isValid(e)},getUploads:function(e){return this._uploadData.retrieve(e)},getButton:function(e){return this._getButton(this._buttonIdsForFileIds[e])},drawThumbnail:function(e,t,n,r){if(this._imageGenerator){var i=this._thumbnailUrls[e],s={scale:n>0,maxSize:n>0?n:null};if(!r&&qq.supportedFeatures.imagePreviews){i=this.getFile(e)}if(i==null){return(new qq.Promise).failure(t,"File or URL not found.")}return this._imageGenerator.generate(i,t,s)}}};qq.basePrivateApi={_generateExtraButtonSpecs:function(){var e=this;this._extraButtonSpecs={};qq.each(this._options.extraButtons,function(t,n){var r=n.multiple,i=qq.extend({},e._options.validation,true),s=qq.extend({},n);if(r===undefined){r=e._options.multiple}if(s.validation){qq.extend(i,n.validation,true)}qq.extend(s,{multiple:r,validation:i},true);e._initExtraButton(s)})},_initExtraButton:function(e){var t=this._createUploadButton({element:e.element,multiple:e.multiple,accept:e.validation.acceptFiles,folders:e.folders});this._extraButtonSpecs[t.getButtonId()]=e},_getButtonId:function(e){var t,n;if(e&&!e.blob&&!qq.isBlob(e)){if(qq.isFile(e)){return e.qqButtonId}else if(e.tagName.toLowerCase()==="input"&&e.type.toLowerCase()==="file"){return e.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}t=e.getElementsByTagName("input");qq.each(t,function(e,t){if(t.getAttribute("type")==="file"){n=t;return false}});if(n){return n.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}}},_annotateWithButtonId:function(e,t){if(qq.isFile(e)){e.qqButtonId=this._getButtonId(t)}},_getButton:function(e){var t=this._extraButtonSpecs[e];if(t){return t.element}else if(e===this._defaultButtonId){return this._options.button}},_handleCheckedCallback:function(e){var t=this,n=e.callback();if(qq.isPromise(n)){this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier);return n.then(function(n){t.log(e.name+" promise success for "+e.identifier);e.onSuccess(n)},function(){if(e.onFailure){t.log(e.name+" promise failure for "+e.identifier);e.onFailure()}else{t.log(e.name+" promise failure for "+e.identifier)}})}if(n!==false){e.onSuccess(n)}else{if(e.onFailure){this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback.");e.onFailure()}else{this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed.")}}return n},_createUploadButton:function(e){var t=this,n=e.multiple===undefined?this._options.multiple:e.multiple,r=e.accept||this._options.validation.acceptFiles;var i=new qq.UploadButton({element:e.element,folders:e.folders,name:this._options.request.inputName,multiple:n&&qq.supportedFeatures.ajaxUploading,acceptFiles:r,onChange:function(e){t._onInputChange(e)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus});this._disposeSupport.addDisposer(function(){i.dispose()});t._buttons.push(i);return i},_createUploadHandler:function(e,t){var n=this,r={debug:this._options.debug,maxConnections:this._options.maxConnections,inputName:this._options.request.inputName,cors:this._options.cors,demoMode:this._options.demoMode,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qq.bind(n.log,n),onProgress:function(e,t,r,i){n._onProgress(e,t,r,i);n._options.callbacks.onProgress(e,t,r,i)},onComplete:function(e,t,r,i){var s=n._onComplete(e,t,r,i);if(qq.isPromise(s)){s.done(function(){n._options.callbacks.onComplete(e,t,r,i)})}else{n._options.callbacks.onComplete(e,t,r,i)}},onCancel:function(e,t){return n._handleCheckedCallback({name:"onCancel",callback:qq.bind(n._options.callbacks.onCancel,n,e,t),onSuccess:qq.bind(n._onCancel,n,e,t),identifier:e})},onUpload:function(e,t){n._onUpload(e,t);n._options.callbacks.onUpload(e,t)},onUploadChunk:function(e,t,r){n._options.callbacks.onUploadChunk(e,t,r)},onResume:function(e,t,r){return n._options.callbacks.onResume(e,t,r)},onAutoRetry:function(e,t,r,i){return n._onAutoRetry.apply(n,arguments)},onUuidChanged:function(e,t){n._uploadData.uuidChanged(e,t)}};qq.each(this._options.request,function(e,t){r[e]=t});if(e){qq.each(e,function(e,t){r[e]=t})}return new qq.UploadHandler(r,t)},_createDeleteHandler:function(){var e=this;return new qq.DeleteFileAjaxRequestor({method:this._options.deleteFile.method,maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._options.deleteFile.customHeaders,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,demoMode:this._options.demoMode,cors:this._options.cors,log:qq.bind(e.log,e),onDelete:function(t){e._onDelete(t);e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,n,r){e._onDeleteComplete(t,n,r);e._options.callbacks.onDeleteComplete(t,n,r)}})},_createPasteHandler:function(){var e=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qq.bind(e.log,e),pasteReceived:function(t){e._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(e._options.callbacks.onPasteReceived,e,t),onSuccess:qq.bind(e._handlePasteSuccess,e,t),identifier:"pasted image"})}}})},_createUploadDataTracker:function(){var e=this;return new qq.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,n,r){e._onUploadStatusChange(t,n,r);e._options.callbacks.onStatusChange(t,n,r)}})},_onUploadStatusChange:function(e,t,n){},_handlePasteSuccess:function(e,t){var n=e.type.split("/")[1],r=t;if(r==null){r=this._options.paste.defaultName}r+="."+n;this.addBlobs({name:r,blob:e})},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){if(e.getInProgress()){var t=t||window.event;t.returnValue=e._options.messages.onLeave;return e._options.messages.onLeave}})},_onSubmit:function(e,t){this._netUploadedOrQueued++},_onProgress:function(e,t,n,r){},_onComplete:function(e,t,n,r){if(!n.success){this._netUploadedOrQueued--;this._uploadData.setStatus(e,qq.status.UPLOAD_FAILED)}else{if(n.thumbnailUrl){this._thumbnailUrls[e]=n.thumbnailUrl}this._netUploaded++;this._uploadData.setStatus(e,qq.status.UPLOAD_SUCCESSFUL)}this._maybeParseAndSendUploadError(e,t,n,r);return n.success?true:false},_onCancel:function(e,t){this._netUploadedOrQueued--;clearTimeout(this._retryTimeouts[e]);var n=qq.indexOf(this._storedIds,e);if(!this._options.autoUpload&&n>=0){this._storedIds.splice(n,1)}this._uploadData.setStatus(e,qq.status.CANCELED)},_isDeletePossible:function(){if(!qq.DeleteFileAjaxRequestor||!this._options.deleteFile.enabled){return false}if(this._options.cors.expected){if(qq.supportedFeatures.deleteFileCorsXhr){return true}if(qq.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr){return true}return false}return true},_onSubmitDelete:function(e,t,n){var r=this.getUuid(e),i;if(t){i=qq.bind(t,this,e,r,n)}if(this._isDeletePossible()){return this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:i||qq.bind(this._deleteHandler.sendDelete,this,e,r,n),identifier:e})}else{this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible "+"due to CORS on a user agent that does not support pre-flighting.","warn");return false}},_onDelete:function(e){this._uploadData.setStatus(e,qq.status.DELETING)},_onDeleteComplete:function(e,t,n){var r=this._handler.getName(e);if(n){this._uploadData.setStatus(e,qq.status.DELETE_FAILED);this.log("Delete request for '"+r+"' has failed.","error");if(t.withCredentials===undefined){this._options.callbacks.onError(e,r,"Delete request failed",t)}else{this._options.callbacks.onError(e,r,"Delete request failed with response code "+t.status,t)}}else{this._netUploadedOrQueued--;this._netUploaded--;this._handler.expunge(e);this._uploadData.setStatus(e,qq.status.DELETED);this.log("Delete request for '"+r+"' has succeeded.")}},_onUpload:function(e,t){this._uploadData.setStatus(e,qq.status.UPLOADING)},_onInputChange:function(e){var t;if(qq.supportedFeatures.ajaxUploading){for(t=0;t<e.files.length;t++){this._annotateWithButtonId(e.files[t],e)}this.addFiles(e.files)}else if(e.value.length>0){this.addFiles(e)}qq.each(this._buttons,function(e,t){t.reset()})},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onAutoRetry:function(e,t,n,r,i){var s=this;s._preventRetries[e]=n[s._options.retry.preventRetryResponseProperty];if(s._shouldAutoRetry(e,t,n)){s._maybeParseAndSendUploadError.apply(s,arguments);s._options.callbacks.onAutoRetry(e,t,s._autoRetries[e]+1);s._onBeforeAutoRetry(e,t);s._retryTimeouts[e]=setTimeout(function(){s.log("Retrying "+t+"...");s._autoRetries[e]++;s._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING);if(i){i(e)}else{s._handler.retry(e)}},s._options.retry.autoAttemptDelay*1e3);return true}},_shouldAutoRetry:function(e,t,n){if(!this._preventRetries[e]&&this._options.retry.enableAuto){if(this._autoRetries[e]===undefined){this._autoRetries[e]=0}return this._autoRetries[e]<this._options.retry.maxAutoAttempts}return false},_onBeforeManualRetry:function(e){var t=this._options.validation.itemLimit;if(this._preventRetries[e]){this.log("Retries are forbidden for id "+e,"warn");return false}else if(this._handler.isValid(e)){var n=this._handler.getName(e);if(this._options.callbacks.onManualRetry(e,n)===false){return false}if(t>0&&this._netUploadedOrQueued+1>t){this._itemError("retryFailTooManyItems");return false}this.log("Retrying upload for '"+n+"' (id: "+e+")...");return true}else{this.log("'"+e+"' is not a valid file ID","error");return false}},_manualRetry:function(e,t){if(this._onBeforeManualRetry(e)){this._netUploadedOrQueued++;this._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING);if(t){t(e)}else{this._handler.retry(e)}return true}},_maybeParseAndSendUploadError:function(e,t,n,r){if(!n.success){if(r&&r.status!==200&&!n.error){this._options.callbacks.onError(e,t,"XHR returned response code "+r.status,r)}else{var i=n.error?n.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,i,r)}}},_prepareItemsForUpload:function(e,t,n){var r=this._getValidationDescriptors(e),i=this._getButtonId(e[0]),s=this._getButton(i);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,r,s),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,r,e,t,n,s),identifier:"batch validation"})},_upload:function(e,t,n){var r=this._handler.add(e),i=this._handler.getName(r);this._uploadData.added(r);if(t){this.setParams(t,r)}if(n){this.setEndpoint(n,r)}this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,r,i),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,r,i),onFailure:qq.bind(this._fileOrBlobRejected,this,r,i),identifier:r})},_onSubmitCallbackSuccess:function(e,t){var n;this._uploadData.setStatus(e,qq.status.SUBMITTED);if(qq.supportedFeatures.ajaxUploading){n=this._handler.getFile(e).qqButtonId}else{n=this._getButtonId(this._handler.getInput(e))}if(n){this._buttonIdsForFileIds[e]=n}this._onSubmit.apply(this,arguments);this._onSubmitted.apply(this,arguments);this._options.callbacks.onSubmitted.apply(this,arguments);if(this._options.autoUpload){if(!this._handler.upload(e)){this._uploadData.setStatus(e,qq.status.QUEUED)}}else{this._storeForLater(e)}},_onSubmitted:function(e){},_storeForLater:function(e){this._storedIds.push(e)},_onValidateBatchCallbackSuccess:function(e,t,n,r,i){var s,o=this._options.validation.itemLimit,u=this._netUploadedOrQueued+e.length;if(o===0||u<=o){if(t.length>0){this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,e[0],i),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,t,0,n,r),onFailure:qq.bind(this._onValidateCallbackFailure,this,t,0,n,r),identifier:"Item '"+t[0].name+"', size: "+t[0].size})}else{this._itemError("noFilesError")}}else{s=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,u).replace(/\{itemLimit\}/g,o);this._batchError(s)}},_onValidateCallbackSuccess:function(e,t,n,r){var i=t+1,s=this._getValidationDescriptor(e[t]),o=false;if(this._validateFileOrBlobData(e[t],s)){o=true;this._upload(e[t],n,r)}this._maybeProcessNextItemAfterOnValidateCallback(o,e,i,n,r)},_onValidateCallbackFailure:function(e,t,n,r){var i=t+1;this._fileOrBlobRejected(undefined,e[0].name);this._maybeProcessNextItemAfterOnValidateCallback(false,e,i,n,r)},_maybeProcessNextItemAfterOnValidateCallback:function(e,t,n,r,i){var s=this;if(t.length>n){if(e||!this._options.validation.stopOnFirstInvalidFile){setTimeout(function(){var e=s._getValidationDescriptor(t[n]);s._handleCheckedCallback({name:"onValidate",callback:qq.bind(s._options.callbacks.onValidate,s,t[n]),onSuccess:qq.bind(s._onValidateCallbackSuccess,s,t,n,r,i),onFailure:qq.bind(s._onValidateCallbackFailure,s,t,n,r,i),identifier:"Item '"+e.name+"', size: "+e.size})},0)}}},_validateFileOrBlobData:function(e,t){var n=t.name,r=t.size,i=this._getButtonId(e),s=this._extraButtonSpecs[i],o=s?s.validation:this._options.validation,u=true;if(qq.isFileOrInput(e)&&!this._isAllowedExtension(o.allowedExtensions,n)){this._itemError("typeError",n,e);u=false}else if(r===0){this._itemError("emptyError",n,e);u=false}else if(r&&o.sizeLimit&&r>o.sizeLimit){this._itemError("sizeError",n,e);u=false}else if(r&&r<o.minSizeLimit){this._itemError("minSizeError",n,e);u=false}if(!u){this._fileOrBlobRejected(undefined,n)}return u},_fileOrBlobRejected:function(e){if(e!==undefined){this._uploadData.setStatus(e,qq.status.REJECTED)}},_itemError:function(e,t,n){function h(e,t){r=r.replace(e,t)}var r=this._options.messages[e],i=[],s=[].concat(t),o=s[0],u=this._getButtonId(n),a=this._extraButtonSpecs[u],f=a?a.validation:this._options.validation,l,c;qq.each(f.allowedExtensions,function(e,t){if(qq.isString(t)){i.push(t)}});l=i.join(", ").toLowerCase();h("{file}",this._options.formatFileName(o));h("{extensions}",l);h("{sizeLimit}",this._formatSize(f.sizeLimit));h("{minSizeLimit}",this._formatSize(f.minSizeLimit));c=r.match(/(\{\w+\})/g);if(c!==null){qq.each(c,function(e,t){h(t,s[e])})}this._options.callbacks.onError(null,o,r,undefined);return r},_batchError:function(e){this._options.callbacks.onError(null,null,e,undefined)},_isAllowedExtension:function(e,t){var n=false;if(!e.length){return true}qq.each(e,function(e,r){if(qq.isString(r)){var i=new RegExp("\\."+r+"$","i");if(t.match(i)!=null){n=true;return false}}});return n},_formatSize:function(e){var t=-1;do{e=e/1e3;t++}while(e>999);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_wrapCallbacks:function(){var e,t;e=this;t=function(t,n,r){try{return n.apply(e,r)}catch(i){e.log("Caught exception in '"+t+"' callback - "+i.message,"error")}};for(var n in this._options.callbacks){(function(){var r,i;r=n;i=e._options.callbacks[r];e._options.callbacks[r]=function(){return t(r,i,arguments)}})()}},_parseFileOrBlobDataName:function(e){var t;if(qq.isFileOrInput(e)){if(e.value){t=e.value.replace(/.*(\/|\\)/,"")}else{t=e.fileName!==null&&e.fileName!==undefined?e.fileName:e.name}}else{t=e.name}return t},_parseFileOrBlobDataSize:function(e){var t;if(qq.isFileOrInput(e)){if(e.value===undefined){t=e.fileSize!==null&&e.fileSize!==undefined?e.fileSize:e.size}}else{t=e.blob.size}return t},_getValidationDescriptor:function(e){var t={},n=this._parseFileOrBlobDataName(e),r=this._parseFileOrBlobDataSize(e);t.name=n;if(r!==undefined){t.size=r}return t},_getValidationDescriptors:function(e){var t=this,n=[];qq.each(e,function(e,r){n.push(t._getValidationDescriptor(r))});return n},_createParamsStore:function(e){var t={},n=this;return{setParams:function(e,n){var r={};qq.extend(r,e);t[n]=r},getParams:function(r){var i={};if(r!=null&&t[r]){qq.extend(i,t[r])}else{qq.extend(i,n._options[e].params)}return i},remove:function(e){return delete t[e]},reset:function(){t={}}}},_createEndpointStore:function(e){var t={},n=this;return{setEndpoint:function(e,n){t[n]=e},getEndpoint:function(r){if(r!=null&&t[r]){return t[r]}return n._options[e].endpoint},remove:function(e){return delete t[e]},reset:function(){t={}}}},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){var e="image/*;capture=camera",t=this._options.camera.button,n=t?this._getButtonId(t):this._defaultButtonId,r=n?this._extraButtonSpecs[n]:this._options;r.multiple=false;if(r.validation.acceptFiles===null){r.validation.acceptFiles=e}else{r.validation.acceptFiles+=","+e}qq.each(this._buttons,function(e,t){if(t.getButtonId()===n){t.setMultiple(r.multiple);t.setAcceptFiles(r.acceptFiles);return false}})}}};qq.FineUploaderBasic=function(e){this._options={debug:false,button:null,multiple:true,maxConnections:3,disableCancelForFormUploads:false,autoUpload:true,request:{endpoint:"/server/upload",params:{},paramsInBody:true,customHeaders:{},forceMultipart:true,inputName:"qqfile",uuidName:"qquuid",totalFileSizeName:"qqtotalfilesize",filenameParam:"qqfilename"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:true,acceptFiles:null},callbacks:{onSubmit:function(e,t){},onSubmitted:function(e,t){},onComplete:function(e,t,n,r){},onCancel:function(e,t){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onResume:function(e,t,n){},onProgress:function(e,t,n,r){},onError:function(e,t,n,r){},onAutoRetry:function(e,t,n){},onManualRetry:function(e,t){},onValidateBatch:function(e){},onValidate:function(e){},onSubmitDelete:function(e){},onDelete:function(e){},onDeleteComplete:function(e,t,n){},onPasteReceived:function(e){},onStatusChange:function(e,t,n){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},retry:{enableAuto:false,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:false,partSize:2e6,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(e){if(e!==undefined&&e.length>33){e=e.slice(0,19)+"..."+e.slice(-14)}return e},text:{defaultResponseError:"Upload failure reason unknown",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:false,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:false,sendCredentials:false,allowXdr:false},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:false,button:null},extraButtons:[]};qq.extend(this._options,e,true);this._buttons=[];this._extraButtonSpecs={};this._buttonIdsForFileIds=[];this._wrapCallbacks();this._disposeSupport=new qq.DisposeSupport;this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._thumbnailUrls=[];this._netUploadedOrQueued=0;this._netUploaded=0;this._uploadData=this._createUploadDataTracker();this._paramsStore=this._createParamsStore("request");this._deleteFileParamsStore=this._createParamsStore("deleteFile");this._endpointStore=this._createEndpointStore("request");this._deleteFileEndpointStore=this._createEndpointStore("deleteFile");this._handler=this._createUploadHandler();this._deleteHandler=qq.DeleteFileAjaxRequestor&&this._createDeleteHandler();if(this._options.button){this._defaultButtonId=this._createUploadButton({element:this._options.button}).getButtonId()}this._generateExtraButtonSpecs();this._handleCameraAccess();if(this._options.paste.targetElement){if(qq.PasteSupport){this._pasteHandler=this._createPasteHandler()}else{qq.log("Paste support module not found","info")}}this._preventLeaveInProgress();this._imageGenerator=qq.ImageGenerator&&new qq.ImageGenerator(qq.bind(this.log,this))};qq.FineUploaderBasic.prototype=qq.basePublicApi;qq.extend(qq.FineUploaderBasic.prototype,qq.basePrivateApi);qq.AjaxRequestor=function(e){"use strict";function o(){return s.method.toUpperCase()}function u(){return qq.indexOf(["GET","POST","HEAD"],o())>=0}function a(e){var t=false;qq.each(t,function(e,n){if(qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],n)<0){t=true;return false}});return t}function f(e){return s.cors.expected&&e.withCredentials===undefined}function l(){var e;if(window.XMLHttpRequest||window.ActiveXObject){e=qq.createXhrInstance();if(e.withCredentials===undefined){e=new XDomainRequest}}return e}function c(e,t){var n=i[e].xhr;if(!n&&!t){if(s.cors.expected){n=l()}else{n=qq.createXhrInstance()}i[e].xhr=n}return n}function h(e){var t=qq.indexOf(r,e),n=s.maxConnections,o;delete i[e];r.splice(t,1);if(r.length>=n&&t<n){o=r[n-1];v(o)}}function p(e,n){var r=c(e),i=o(),u=n===true;h(e);if(u){t(i+" request for "+e+" has failed","error")}else if(!f(r)&&!S(r.status)){u=true;t(i+" request for "+e+" has failed - response code "+r.status,"error")}s.onComplete(e,r,u)}function d(e){var t=i[e].onDemandParams,n=s.mandatedParams,r;if(s.paramsStore.getParams){r=s.paramsStore.getParams(e)}if(t){qq.each(t,function(e,t){r=r||{};r[e]=t})}if(n){qq.each(n,function(e,t){r=r||{};r[e]=t})}return r}function v(e){var r=c(e),u=o(),a=d(e),l=i[e].body,h;s.onSend(e);h=m(e,a);if(f(r)){r.onload=y(e);r.onerror=b(e)}else{r.onreadystatechange=g(e)}r.open(u,h,true);if(s.cors.expected&&s.cors.sendCredentials&&!f(r)){r.withCredentials=true}w(e);t("Sending "+u+" request for "+e);if(l){r.send(l)}else if(n||!a){r.send()}else if(a&&s.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0){r.send(qq.obj2url(a,""))}else if(a&&s.contentType.toLowerCase().indexOf("application/json")>=0){r.send(JSON.stringify(a))}else{r.send(a)}}function m(e,t){var r=s.endpointStore.getEndpoint(e),o=i[e].addToPath;if(o!=undefined){r+="/"+o}if(n&&t){return qq.obj2url(t,r)}else{return r}}function g(e){return function(){if(c(e).readyState===4){p(e)}}}function y(e){return function(){p(e)}}function b(e){return function(){p(e,true)}}function w(e){var t=c(e),n=s.customHeaders,r=i[e].additionalHeaders||{},l=o(),h={};if(f(t)){if(!s.cors.expected||!u()||a(n)){t.setRequestHeader("X-Requested-With","XMLHttpRequest");t.setRequestHeader("Cache-Control","no-cache")}}if(s.contentType&&(l==="POST"||l==="PUT")&&!f(t)){t.setRequestHeader("Content-Type",s.contentType)}if(!f(t)){qq.extend(h,n);qq.extend(h,r);qq.each(h,function(e,n){t.setRequestHeader(e,n)})}}function E(e){var n=c(e,true),r=o();if(n){if(f(n)){n.onerror=null;n.onload=null}else{n.onreadystatechange=null}n.abort();h(e);t("Cancelled "+r+" for "+e);s.onCancel(e);return true}return false}function S(e){return qq.indexOf(s.successfulResponseCodes[o()],e)>=0}var t,n,r=[],i=[],s={validMethods:["POST"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},successfulResponseCodes:{DELETE:[200,202,204],POST:[200,204]},cors:{expected:false,sendCredentials:false},log:function(e,t){},onSend:function(e){},onComplete:function(e,t,n){},onCancel:function(e){}};qq.extend(s,e);t=s.log;if(qq.indexOf(s.validMethods,o())<0){throw new Error("'"+o()+"' is not a supported method for this type of request!")}n=o()==="GET"||o()==="DELETE";return{send:function(e,t,n,o,u){i[e]={addToPath:t,onDemandParams:n,additionalHeaders:o,body:u};var a=r.push(e);if(a<=s.maxConnections){v(e)}},cancel:function(e){return E(e)},getMethod:function(){return o()}}};qq.UploadHandler=function(e,t){"use strict";function u(e){var t=qq.indexOf(n,e),i=r.maxConnections,o;if(t>=0){n.splice(t,1);if(n.length>=i&&t<i){o=n[i-1];s.upload(o)}}}function a(e){i("Cancelling "+e);r.paramsStore.remove(e);u(e)}function f(){var e=t?qq[t]:qq,n=qq.supportedFeatures.ajaxUploading?"Xhr":"Form";s=new e["UploadHandler"+n](r,u,r.onUuidChanged,i)}var n=[],r,i,s,o;r={debug:false,forceMultipart:true,paramsInBody:false,paramsStore:{},endpointStore:{},filenameParam:"qqfilename",cors:{expected:false,sendCredentials:false},maxConnections:3,uuidParam:"qquuid",totalFileSizeParam:"qqtotalfilesize",chunking:{enabled:false,partSize:2e6,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},log:function(e,t){},onProgress:function(e,t,n,r){},onComplete:function(e,t,n,r){},onCancel:function(e,t){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onAutoRetry:function(e,t,n,r){},onResume:function(e,t,n){},onUuidChanged:function(e,t){}};qq.extend(r,e);i=r.log;o={add:function(e){return s.add(e)},upload:function(e){var t=n.push(e);if(t<=r.maxConnections){s.upload(e);return true}return false},retry:function(e){var t=qq.indexOf(n,e);if(t>=0){return s.upload(e,true)}else{return this.upload(e)}},cancel:function(e){var t=s.cancel(e);if(qq.isPromise(t)){t.then(function(){a(e)})}else if(t!==false){a(e)}},cancelAll:function(){var e=this,t=[];qq.extend(t,n);qq.each(t,function(t,n){e.cancel(n)});n=[]},getName:function(e){return s.getName(e)},setName:function(e,t){s.setName(e,t)},getSize:function(e){if(s.getSize){return s.getSize(e)}},getFile:function(e){if(s.getFile){return s.getFile(e)}},getInput:function(e){if(s.getInput){return s.getInput(e)}},reset:function(){i("Resetting upload handler");o.cancelAll();n=[];s.reset()},expunge:function(e){return s.expunge(e)},getUuid:function(e){return s.getUuid(e)},setUuid:function(e,t){return s.setUuid(e,t)},isValid:function(e){return s.isValid(e)},getResumableFilesData:function(){if(s.getResumableFilesData){return s.getResumableFilesData()}return[]},getThirdPartyFileId:function(e){if(s.getThirdPartyFileId&&o.isValid(e)){return s.getThirdPartyFileId(e)}}};f();return o};qq.UploadHandlerFormApi=function(e,t,n,r,i,s,o){"use strict";function p(r){delete l[r];delete t[r];if(n){clearTimeout(c[r]);delete c[r];a.stopReceivingMessages(r)}var i=document.getElementById(e.getIframeName(r));if(i){i.setAttribute("src","java"+String.fromCharCode(115)+"cript:false;");qq(i).remove()}}function d(n,r){var i=n.id,s=m(i),u=t[s].uuid;f[u]=r;l[s]=qq(n).attach("load",function(){if(t[s].input){o("Received iframe load event for CORS upload request (iframe name "+i+")");c[i]=setTimeout(function(){var e="No valid message received from loaded iframe for iframe name "+i;o(e,"error");r({error:e})},1e3)}});a.receiveMessage(i,function(t){o("Received the following window message: '"+t+"'");var n=m(i),r=e.parseJsonResponse(n,t),s=r.uuid,u;if(s&&f[s]){o("Handling response for iframe name "+i);clearTimeout(c[i]);delete c[i];e.detachLoadEvent(i);u=f[s];delete f[s];a.stopReceivingMessages(i);u(r)}else if(!s){o("'"+t+"' does not contain a UUID - ignoring.")}})}function v(e){var t=qq.toElement('<iframe src="javascript:false;" name="'+e+'" />');t.setAttribute("id",e);t.style.display="none";document.body.appendChild(t);return t}function m(e){return e.split("_")[0]}var u=qq.getUniqueId(),a=new qq.WindowReceiveMessage({log:o}),f={},l={},c={},h;qq.extend(e,{getIframeName:function(e){return e+"_"+u},createIframe:function(t){var n=e.getIframeName(t);return v(n)},parseJsonResponse:function(e,t){var n;try{n=qq.parseJson(t);if(n.newUuid!==undefined){h.setUuid(e,n.newUuid)}}catch(r){o("Error when attempting to parse iframe upload response ("+r.message+")","error");n={}}return n},initFormForUpload:function(e){var t=e.method,n=e.endpoint,r=e.params,i=e.paramsInBody,s=e.targetName,o=qq.toElement('<form method="'+t+'" enctype="multipart/form-data"></form>'),u=n;if(i){qq.obj2Inputs(r,o)}else{u=qq.obj2url(r,n)}o.setAttribute("action",u);o.setAttribute("target",s);o.style.display="none";document.body.appendChild(o);return o},attachLoadEvent:function(e,t){var r;if(n){d(e,t)}else{l[e.id]=qq(e).attach("load",function(){o("Received response for "+e.id);if(!e.parentNode){return}try{if(e.contentDocument&&e.contentDocument.body&&e.contentDocument.body.innerHTML=="false"){return}}catch(n){o("Error when attempting to access iframe during handling of upload response ("+n.message+")","error");r={success:false}}t(r)})}},detachLoadEvent:function(e){if(l[e]!==undefined){l[e]();delete l[e]}}});h={add:function(e){var n=t.push({input:e})-1;e.setAttribute("name",r);t[n].uuid=qq.getUniqueId();if(e.parentNode){qq(e).remove()}return n},getName:function(e){if(t[e].newName!==undefined){return t[e].newName}else if(h.isValid(e)){return t[e].input.value.replace(/.*(\/|\\)/,"")}else{o(e+" is not a valid item ID.","error")}},getInput:function(e){return t[e].input},setName:function(e,n){t[e].newName=n},isValid:function(e){return t[e]!==undefined&&t[e].input!==undefined},reset:function(){t.length=0},expunge:function(e){return p(e)},getUuid:function(e){return t[e].uuid},cancel:function(e){var t=i(e,h.getName(e));if(qq.isPromise(t)){return t.then(function(){h.expunge(e)})}else if(t!==false){h.expunge(e);return true}return false},upload:function(e){},setUuid:function(e,n){o("Server requested UUID change from '"+t[e].uuid+"' to '"+n+"'");t[e].uuid=n;s(e,n)}};return h};qq.UploadHandlerXhrApi=function(e,t,n,r,i,s,o){"use strict";function a(e,t,n){if(e.slice){return e.slice(t,n)}else if(e.mozSlice){return e.mozSlice(t,n)}else if(e.webkitSlice){return e.webkitSlice(t,n)}}var u;qq.extend(e,{createXhr:function(e){var n=qq.createXhrInstance();t[e].xhr=n;return n},getTotalChunks:function(e){if(n){var t=u.getSize(e),r=n.partSize;return Math.ceil(t/r)}},getChunkData:function(t,r){var i=n.partSize,s=u.getSize(t),o=u.getFile(t),f=i*r,l=f+i>=s?s:f+i,c=e.getTotalChunks(t);return{part:r,start:f,end:l,count:c,blob:a(o,f,l),size:l-f}},getChunkDataForCallback:function(e){return{partIndex:e.part,startByte:e.start+1,endByte:e.end,totalParts:e.count}}});u={add:function(e){var n,r=qq.getUniqueId();if(qq.isFile(e)){n=t.push({file:e})-1}else if(qq.isBlob(e.blob)){n=t.push({blobData:e})-1}else{throw new Error("Passed obj in not a File or BlobData (in qq.UploadHandlerXhr)")}t[n].uuid=r;return n},getName:function(e){if(u.isValid(e)){var n=t[e].file,r=t[e].blobData,i=t[e].newName;if(i!==undefined){return i}else if(n){return n.fileName!==null&&n.fileName!==undefined?n.fileName:n.name}else{return r.name}}else{o(e+" is not a valid item ID.","error")}},setName:function(e,n){t[e].newName=n},getSize:function(e){var n=t[e].file||t[e].blobData.blob;if(qq.isFileOrInput(n)){return n.fileSize!=null?n.fileSize:n.size}else{return n.size}},getFile:function(e){if(t[e]){return t[e].file||t[e].blobData.blob}},isValid:function(e){return t[e]!==undefined},reset:function(){t.length=0},expunge:function(e){var n=t[e].xhr;if(n){n.onreadystatechange=null;n.abort()}delete t[e]},getUuid:function(e){return t[e].uuid},upload:function(e,t){return r(e,t)},cancel:function(e){var t=i(e,u.getName(e));if(qq.isPromise(t)){return t.then(function(){u.expunge(e)})}else if(t!==false){u.expunge(e);return true}return false},setUuid:function(e,n){o("Server requested UUID change from '"+t[e].uuid+"' to '"+n+"'");t[e].uuid=n;s(e,n)}};return u};qq.WindowReceiveMessage=function(e){var t={log:function(e,t){}},n={};qq.extend(t,e);return{receiveMessage:function(e,t){var r=function(e){t(e.data)};if(window.postMessage){n[e]=qq(window).attach("message",r)}else{log("iframe message passing not supported in this browser!","error")}},stopReceivingMessages:function(e){if(window.postMessage){var t=n[e];if(t){t()}}}}};qq.UploadHandlerForm=function(e,t,n,r){"use strict";function f(e,t){var n;try{var r=t.contentDocument||t.contentWindow.document,i=r.body.innerHTML;o("converting iframe's innerHTML to JSON");o("innerHTML = "+i);if(i&&i.match(/^<pre/i)){i=r.body.firstChild.firstChild.nodeValue}n=u.parseJsonResponse(e,i)}catch(s){o("Error when attempting to parse form upload response ("+s.message+")","error");n={success:false}}return n}function l(t,n){var r=e.paramsStore.getParams(t),s=e.demoMode?"GET":"POST",o=e.endpointStore.getEndpoint(t),f=i[t].newName||a.getName(t);r[e.uuidParam]=i[t].uuid;r[e.filenameParam]=f;return u.initFormForUpload({method:s,endpoint:o,params:r,paramsInBody:e.paramsInBody,targetName:n.name})}var i=[],s=t,o=r,u={},a;a=new qq.UploadHandlerFormApi(u,i,e.cors.expected,e.inputName,e.onCancel,n,o);return qq.extend(a,{upload:function(t){var n=i[t].input,r=a.getName(t),c=u.createIframe(t),h;if(!n){throw new Error("file with passed id was not added, or already uploaded or cancelled")}e.onUpload(t,a.getName(t));h=l(t,c);h.appendChild(n);u.attachLoadEvent(c,function(n){o("iframe loaded");var i=n?n:f(t,c);u.detachLoadEvent(t);if(!e.cors.expected){qq(c).remove()}if(!i.success){if(e.onAutoRetry(t,r,i)){return}}e.onComplete(t,r,i);s(t)});o("Sending upload request for "+t);h.submit();qq(h).remove()}})};qq.UploadHandlerXhr=function(e,t,n,r){"use strict";function d(t,n,r){var i=p.getSize(t),s=p.getName(t);n[e.chunking.paramNames.partIndex]=r.part;n[e.chunking.paramNames.partByteOffset]=r.start;n[e.chunking.paramNames.chunkSize]=r.size;n[e.chunking.paramNames.totalParts]=r.count;n[e.totalFileSizeParam]=i;if(c){n[e.filenameParam]=s}}function v(t){t[e.resume.paramNames.resuming]=true}function m(e,t,n){if(e.slice){return e.slice(t,n)}else if(e.mozSlice){return e.mozSlice(t,n)}else if(e.webkitSlice){return e.webkitSlice(t,n)}}function g(t,n,r,i){var s=new FormData,u=e.demoMode?"GET":"POST",a=e.endpointStore.getEndpoint(i),f=a,l=o[i].newName||p.getName(i),h=p.getSize(i);t[e.uuidParam]=o[i].uuid;t[e.filenameParam]=l;if(c){t[e.totalFileSizeParam]=h}if(!e.paramsInBody){if(!c){t[e.inputName]=l}f=qq.obj2url(t,a)}n.open(u,f,true);if(e.cors.expected&&e.cors.sendCredentials){n.withCredentials=true}if(c){if(e.paramsInBody){qq.obj2FormData(t,s)}s.append(e.inputName,r);return s}return r}function y(t,n){var r=e.customHeaders,i=o[t].file||o[t].blobData.blob;n.setRequestHeader("X-Requested-With","XMLHttpRequest");n.setRequestHeader("Cache-Control","no-cache");if(!c){n.setRequestHeader("Content-Type","application/octet-stream");n.setRequestHeader("X-Mime-Type",i.type)}qq.each(r,function(e,t){n.setRequestHeader(e,t)})}function b(t,n,r){var s=p.getName(t),u=p.getSize(t);o[t].attemptingResume=false;e.onProgress(t,s,u,u);e.onComplete(t,s,n,r);if(o[t]){delete o[t].xhr}i(t)}function w(t){var n=o[t].remainingChunkIdxs[0],r=h.getChunkData(t,n),i=h.createXhr(t),u=p.getSize(t),a=p.getName(t),l,c;if(o[t].loaded===undefined){o[t].loaded=0}if(f&&o[t].file){M(t,r)}i.onreadystatechange=O(t,i);i.upload.onprogress=function(r){if(r.lengthComputable){var i=r.loaded+o[t].loaded,s=E(t,n,r.total);e.onProgress(t,a,i,s)}};e.onUploadChunk(t,a,h.getChunkDataForCallback(r));c=e.paramsStore.getParams(t);d(t,c,r);if(o[t].attemptingResume){v(c)}l=g(c,i,r.blob,t);y(t,i);s("Sending chunked upload request for item "+t+": bytes "+(r.start+1)+"-"+r.end+" of "+u);i.send(l)}function E(e,t,n){var r=h.getChunkData(e,t),i=r.size,s=n-i,u=p.getSize(e),a=r.count,f=o[e].initialRequestOverhead,l=s-f;o[e].lastRequestOverhead=s;if(t===0){o[e].lastChunkIdxProgress=0;o[e].initialRequestOverhead=s;o[e].estTotalRequestsSize=u+a*s}else if(o[e].lastChunkIdxProgress!==t){o[e].lastChunkIdxProgress=t;o[e].estTotalRequestsSize+=l}return o[e].estTotalRequestsSize}function S(e){if(c){return o[e].lastRequestOverhead}else{return 0}}function x(e,t,n){var r=o[e].remainingChunkIdxs.shift(),i=h.getChunkData(e,r);o[e].attemptingResume=false;o[e].loaded+=i.size+S(e);if(o[e].remainingChunkIdxs.length>0){w(e)}else{if(f){_(e)}b(e,t,n)}}function T(e,t){return e.status!==200||!t.success||t.reset}function N(e,t){var n;try{s(qq.format("Received response status {} with body: {}",t.status,t.responseText));n=qq.parseJson(t.responseText);if(n.newUuid!==undefined){p.setUuid(e,n.newUuid)}}catch(r){s("Error when attempting to parse xhr response text ("+r.message+")","error");n={}}return n}function C(e){s("Server has ordered chunking effort to be restarted on next attempt for item ID "+e,"error");if(f){_(e);o[e].attemptingResume=false}o[e].remainingChunkIdxs=[];delete o[e].loaded;delete o[e].estTotalRequestsSize;delete o[e].initialRequestOverhead}function k(e){o[e].attemptingResume=false;s("Server has declared that it cannot handle resume for item ID "+e+" - starting from the first chunk","error");C(e);p.upload(e,true)}function L(t,n,r){var i=p.getName(t);if(e.onAutoRetry(t,i,n,r)){return}else{b(t,n,r)}}function A(e,t){var n;if(!o[e]){return}s("xhr - server response received for "+e);s("responseText = "+t.responseText);n=N(e,t);if(T(t,n)){if(n.reset){C(e)}if(o[e].attemptingResume&&n.reset){k(e)}else{L(e,n,t)}}else if(a){x(e,n,t)}else{b(e,n,t)}}function O(e,t){return function(){if(t.readyState===4){A(e,t)}}}function M(t,n){var r=p.getUuid(t),i=o[t].loaded,s=o[t].initialRequestOverhead,a=o[t].estTotalRequestsSize,f=P(t),l=r+u+n.part+u+i+u+s+u+a,c=e.resume.cookiesExpireIn;qq.setCookie(f,l,c)}function _(e){if(o[e].file){var t=P(e);qq.deleteCookie(t)}}function D(e){var t=qq.getCookie(P(e)),n=p.getName(e),r,i,o,a,f,l;if(t){r=t.split(u);if(r.length===5){i=r[0];o=parseInt(r[1],10);a=parseInt(r[2],10);f=parseInt(r[3],10);l=parseInt(r[4],10);return{uuid:i,part:o,lastByteSent:a,initialRequestOverhead:f,estTotalRequestsSize:l}}else{s("Ignoring previously stored resume/chunk cookie for "+n+" - old cookie format","warn")}}}function P(t){var n=p.getName(t),r=p.getSize(t),i=e.chunking.partSize,s;s="qqfilechunk"+u+encodeURIComponent(n)+u+r+u+i;if(l!==undefined){s+=u+l}return s}function H(){if(e.resume.id!==null&&e.resume.id!==undefined&&!qq.isFunction(e.resume.id)&&!qq.isObject(e.resume.id)){return e.resume.id}}function B(e,t){var n;for(n=h.getTotalChunks(e)-1;n>=t;n-=1){o[e].remainingChunkIdxs.unshift(n)}w(e)}function j(e,t,n,r){n=r.part;o[e].loaded=r.lastByteSent;o[e].estTotalRequestsSize=r.estTotalRequestsSize;o[e].initialRequestOverhead=r.initialRequestOverhead;o[e].attemptingResume=true;s("Resuming "+t+" at partition index "+n);B(e,n)}function F(t,n,r){var i=p.getName(t),o=h.getChunkData(t,n.part),u;u=e.onResume(t,i,h.getChunkDataForCallback(o));if(qq.isPromise(u)){s("Waiting for onResume promise to be fulfilled for "+t);u.then(function(){j(t,i,r,n)},function(){s("onResume promise fulfilled - failure indicated.  Will not resume.");B(t,r)})}else if(u!==false){j(t,i,r,n)}else{s("onResume callback returned false.  Will not resume.");B(t,r)}}function I(e,t){var n=0,r;if(!o[e].remainingChunkIdxs||o[e].remainingChunkIdxs.length===0){o[e].remainingChunkIdxs=[];if(f&&!t&&o[e].file){r=D(e);if(r){F(e,r,n)}else{B(e,n)}}else{B(e,n)}}else{w(e)}}function q(t){var n=o[t].file||o[t].blobData.blob,r=p.getName(t),i,u,a;o[t].loaded=0;i=h.createXhr(t);i.upload.onprogress=function(n){if(n.lengthComputable){o[t].loaded=n.loaded;e.onProgress(t,r,n.loaded,n.total)}};i.onreadystatechange=O(t,i);u=e.paramsStore.getParams(t);a=g(u,i,n,t);y(t,i);s("Sending upload request for "+t);i.send(a)}function R(t,n){var r=p.getName(t);if(p.isValid(t)){e.onUpload(t,r);if(a){I(t,n)}else{q(t)}}}var i=t,s=r,o=[],u="|",a=e.chunking.enabled&&qq.supportedFeatures.chunking,f=e.resume.enabled&&a&&qq.supportedFeatures.resume,l=H(),c=e.forceMultipart||e.paramsInBody,h={},p;p=new qq.UploadHandlerXhrApi(h,o,a?e.chunking:null,R,e.onCancel,n,s);qq.override(p,function(t){return{add:function(e){var n=t.add(e),r;if(f){r=D(n);if(r){o[n].uuid=r.uuid}}return n},getResumableFilesData:function(){var t=[],n=[];if(a&&f){if(l===undefined){t=qq.getCookieNames(new RegExp("^qqfilechunk\\"+u+".+\\"+u+"\\d+\\"+u+e.chunking.partSize+"="))}else{t=qq.getCookieNames(new RegExp("^qqfilechunk\\"+u+".+\\"+u+"\\d+\\"+u+e.chunking.partSize+"\\"+u+l+"="))}qq.each(t,function(e,t){var r=t.split(u);var i=qq.getCookie(t).split(u);n.push({name:decodeURIComponent(r[1]),size:r[2],uuid:i[0],partIdx:i[1]})});return n}return[]},expunge:function(e){if(f){_(e)}t.expunge(e)}}});return p};qq.DragAndDrop=function(e){"use strict";function o(e,n){t.callbacks.dropLog("Grabbed "+e.length+" dropped files.");n.dropDisabled(false);t.callbacks.processingDroppedFilesComplete(e)}function u(e){var n,r=new qq.Promise;if(e.isFile){e.file(function(e){i.push(e);r.success()},function(n){t.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+n.code+".","error");r.failure()})}else if(e.isDirectory){n=e.createReader();n.readEntries(function(e){var t=e.length;qq.each(e,function(e,n){u(n).done(function(){t-=1;if(t===0){r.success()}})});if(!e.length){r.success()}},function(n){t.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+n.code+".","error");r.failure()})}return r}function a(e,n){var r=[],s=new qq.Promise;t.callbacks.processingDroppedFiles();n.dropDisabled(true);if(e.files.length>1&&!t.allowMultipleItems){t.callbacks.processingDroppedFilesComplete([]);t.callbacks.dropError("tooManyFilesError","");n.dropDisabled(false);s.failure()}else{i=[];if(qq.isFolderDropSupported(e)){qq.each(e.items,function(e,t){var n=t.webkitGetAsEntry();if(n){if(n.isFile){i.push(t.getAsFile())}else{r.push(u(n).done(function(){r.pop();if(r.length===0){s.success()}}))}}})}else{i=e.files}if(r.length===0){s.success()}}return s}function f(e){var u=new qq.UploadDropZone({element:e,onEnter:function(n){qq(e).addClass(t.classes.dropActive);n.stopPropagation()},onLeaveNotDescendants:function(n){qq(e).removeClass(t.classes.dropActive)},onDrop:function(r){qq(e).hasAttribute(n)&&qq(e).hide();qq(e).removeClass(t.classes.dropActive);a(r.dataTransfer,u).done(function(){o(i,u)})}});s.addDisposer(function(){u.dispose()});qq(e).hasAttribute(n)&&qq(e).hide();r.push(u);return u}function l(e){var t;qq.each(e.dataTransfer.types,function(e,n){if(n==="Files"){t=true;return false}});return t}function c(e){return(qq.chrome()||qq.safari()&&qq.windows())&&e.clientX==0&&e.clientY==0||qq.firefox()&&!e.relatedTarget}function h(){var e=t.dropZoneElements;qq.each(e,function(t,n){var r=f(n);if(e.length&&(!qq.ie()||qq.ie10())){s.attach(document,"dragenter",function(t){if(!r.dropDisabled()&&l(t)){qq.each(e,function(e,t){qq(t).css({display:"block"})})}})}});s.attach(document,"dragleave",function(t){if(c(t)){qq.each(e,function(e,t){qq(t).hasAttribute(n)&&qq(t).hide()})}});s.attach(document,"drop",function(t){qq.each(e,function(e,t){qq(t).hasAttribute(n)&&qq(t).hide()});t.preventDefault()})}var t,n="qq-hide-dropzone",r=[],i=[],s=new qq.DisposeSupport;t={dropZoneElements:[],allowMultipleItems:true,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks};qq.extend(t,e,true);h();return{setupExtraDropzone:function(e){t.dropZoneElements.push(e);f(e)},removeDropzone:function(e){var n,r=t.dropZoneElements;for(n in r){if(r[n]===e){return r.splice(n,1)}}},dispose:function(){s.dispose();qq.each(r,function(e,t){t.dispose()})}}};qq.DragAndDrop.callbacks=function(){return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(e){},dropError:function(e,t){qq.log("Drag & drop error code '"+e+" with these specifics: '"+t+"'","error")},dropLog:function(e,t){qq.log(e,t)}}};qq.UploadDropZone=function(e){"use strict";function o(){return qq.safari()||qq.firefox()&&qq.windows()}function u(e){if(!i){if(o){s.attach(document,"dragover",function(e){e.preventDefault()})}else{s.attach(document,"dragover",function(e){if(e.dataTransfer){e.dataTransfer.dropEffect="none";e.preventDefault()}})}i=true}}function a(e){if(qq.ie()&&!qq.ie10()){return false}var t,n=e.dataTransfer,r=qq.safari();t=qq.ie10()?true:n.effectAllowed!=="none";return n&&t&&(n.files||!r&&n.types.contains&&n.types.contains("Files"))}function f(e){if(e!==undefined){r=e}return r}function l(){s.attach(n,"dragover",function(e){if(!a(e)){return}var t=qq.ie()?null:e.dataTransfer.effectAllowed;if(t==="move"||t==="linkMove"){e.dataTransfer.dropEffect="move"}else{e.dataTransfer.dropEffect="copy"}e.stopPropagation();e.preventDefault()});s.attach(n,"dragenter",function(e){if(!f()){if(!a(e)){return}t.onEnter(e)}});s.attach(n,"dragleave",function(e){if(!a(e)){return}t.onLeave(e);var n=document.elementFromPoint(e.clientX,e.clientY);if(qq(this).contains(n)){return}t.onLeaveNotDescendants(e)});s.attach(n,"drop",function(e){if(!f()){if(!a(e)){return}e.preventDefault();t.onDrop(e)}})}var t,n,r,i,s=new qq.DisposeSupport;t={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}};qq.extend(t,e);n=t.element;u();l();return{dropDisabled:function(e){return f(e)},dispose:function(){s.dispose()}}};(function(e){"use strict";function r(e){if(e){var n=f(e),r=i(n);o(r);a(n,r)}return t}function i(e){var t=u("uploaderType"),n=u("endpointType");if(t){t=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();if(n){return new qq[n]["FineUploader"+t](e)}return new qq["FineUploader"+t](e)}else{if(n){return new qq[n]["FineUploader"](e)}return new qq.FineUploader(e)}}function s(e,n){var r=t.data("fineuploader");if(n){if(r===undefined){r={}}r[e]=n;t.data("fineuploader",r)}else{if(r===undefined){return null}return r[e]}}function o(e){return s("uploader",e)}function u(e,t){return s(e,t)}function a(n,r){var i=n.callbacks={};e.each(r._options.callbacks,function(n,r){var s,o;s=/^on(\w+)/.exec(n)[1];s=s.substring(0,1).toLowerCase()+s.substring(1);o=t;i[n]=function(){var t=Array.prototype.slice.call(arguments),n=[],i,u;e.each(t,function(e,t){n.push(h(t))});i=r.apply(this,t);u=o.triggerHandler(s,n);if(i!=null){return i}return u}});r._options.callbacks=i}function f(r,i){var s,o;if(i===undefined){if(r.uploaderType!=="basic"){s={element:t[0]}}else{s={}}}else{s=i}e.each(r,function(t,r){if(e.inArray(t,n)>=0){u(t,r)}else if(r instanceof e){s[t]=r[0]}else if(e.isPlainObject(r)){s[t]={};f(r,s[t])}else if(e.isArray(r)){o=[];e.each(r,function(t,n){var r={};if(n instanceof e){e.merge(o,n)}else if(e.isPlainObject(n)){f(n,r);o.push(r)}else{o.push(n)}});s[t]=o}else{s[t]=r}});if(i===undefined){return s}}function l(t){return e.type(t)==="string"&&!t.match(/^_/)&&o()[t]!==undefined}function c(e){var t=[],n=Array.prototype.slice.call(arguments,1),r;f(n,t);r=o()[e].apply(o(),t);return h(r)}function h(t){var n=t;if(t!=null&&typeof t==="object"&&(t.nodeType===1||t.nodeType===9)&&t.cloneNode){n=e(t)}return n}var t,n=["uploaderType","endpointType"];e.fn.fineUploader=function(n){var i=this,s=arguments,u=[];this.each(function(a,f){t=e(f);if(o()&&l(n)){u.push(c.apply(i,s));if(i.length===1){return false}}else if(typeof n==="object"||!n){r.apply(i,s)}else{e.error("Method "+n+" does not exist on jQuery.fineUploader")}});if(u.length===1){return u[0]}else if(u.length>1){return u}return this}})(eds1_10);(function(e){"use strict";function r(e){if(!e){e={}}e.dropZoneElements=[n];var t=u(e);o(t);s(new qq.DragAndDrop(t));return n}function i(e,r){var i=n.data(t);if(r){if(i===undefined){i={}}i[e]=r;n.data(t,i)}else{if(i===undefined){return null}return i[e]}}function s(e){return i("dndInstance",e)}function o(t){var r=t.callbacks={},i=new qq.FineUploaderBasic;e.each(new qq.DragAndDrop.callbacks,function(e,t){var i=e,s;s=n;r[e]=function(){var e=Array.prototype.slice.call(arguments),t=s.triggerHandler(i,e);return t}})}function u(t,n){var r,i;if(n===undefined){r={}}else{r=n}e.each(t,function(t,n){if(n instanceof e){r[t]=n[0]}else if(e.isPlainObject(n)){r[t]={};u(n,r[t])}else if(e.isArray(n)){i=[];e.each(n,function(t,n){if(n instanceof e){e.merge(i,n)}else{i.push(n)}});r[t]=i}else{r[t]=n}});if(n===undefined){return r}}function a(t){return e.type(t)==="string"&&t==="dispose"&&s()[t]!==undefined}function f(e){var t=[],n=Array.prototype.slice.call(arguments,1);u(n,t);return s()[e].apply(s(),t)}var t="fineUploaderDnd",n;e.fn.fineUploaderDnd=function(t){var i=this,o=arguments,u=[];this.each(function(l,c){n=e(c);if(s()&&a(t)){u.push(f.apply(i,o));if(i.length===1){return false}}else if(typeof t==="object"||!t){r.apply(i,o)}else{e.error("Method "+t+" does not exist in Fine Uploader's DnD module.")}});if(u.length===1){return u[0]}else if(u.length>1){return u}return this}})(eds1_10)